# Copyright (C) 1995-2023 Free Software Foundation, Inc.
#
# This file is part of GCC.
#
# GCC is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 3, or (at your option)
# any later version.
#
# GCC is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with GCC; see the file COPYING3.  If not see
# <http://www.gnu.org/licenses/>.

MULTILIB_OPTIONS = msoft-float

# Optimize for space
LIBGCC2_CFLAGS = -Os
CRTSTUFF_T_CFLAGS = -Os

# Because the pdp11 POINTER_SIZE is only 16, in dwarf2out.cc,
# DWARF_ARANGES_PAD_SIZE is 0, thus a loop in output_aranges that checks
# (i < (unsigned) DWARF_ARANGES_PAD_SIZE) elicits a warning that the
# comparison is always false.
# We could say "-Werror -Wno-error=type-limits", alas, not all supported
# gcc bootstrap compilers support the latter option.
dwarf2out.o-warn = -Wno-error

LIB1ASMSRC    = tms9900/lib1funcs.asm
LIB1ASMFUNCS  = _divsi3 _udivsi3 _modsi3 _umodsi3

# Exclude funcs from libgcc2.c that we implement using calls to TI99/4A console
# ROM

LIB2FUNCS_EXCLUDE = __adddf3 __subdf3 __muldf3 __divdf3 __eqdf2 \
 __gedf2 __gtdf2 __ledf2 __ltdf2

# Exclude 64-bit functions we don't need (yet)
LIB2FUNCS_EXCLUDE += _muldi3 _negdi2  _cmpdi2 _ucmpdi2 _lshrdi3 _ashldi3 \
_ashrdi3 _udivdi3 _divdi3 _umoddi3 _moddi3 _addvDI3 _subvDI3 \
__udivmoddi4

LIB2FUNCS_EXTRA = \
 $(srcdir)/config/tms9900/ftoa.c \
 $(srcdir)/config/tms9900/atof.c \
 $(srcdir)/config/tms9900/double.c\
 $(srcdir)/config/tms9900/d_adj_neg_pos.c \
 $(srcdir)/config/tms9900/d_compare.c \
 $(srcdir)/config/tms9900/eqdf2.c \
 $(srcdir)/config/tms9900/gedf2.c \
 $(srcdir)/config/tms9900/gtdf2.c \
 $(srcdir)/config/tms9900/ledf2.c \
 $(srcdir)/config/tms9900/ltdf2.c

# Tell make where to find headers for above
LIBGCC2_INCLUDES += -I$(srcdir)/config/tms9900

# Assemble startup files.  TODO Do we need these?
$(T)crti.o: $(srcdir)/config/tms9900/crti.asm $(GCC_PASSES)
	$(GCC_FOR_TARGET) $(GCC_CFLAGS) $(MULTILIB_CFLAGS) $(INCLUDES) \
	-c -o $(T)crti.o -x assembler-with-cpp $(srcdir)/config/tms9900/crti.asm

$(T)crtn.o: $(srcdir)/config/tms9900/crtn.asm $(GCC_PASSES)
	$(GCC_FOR_TARGET) $(GCC_CFLAGS) $(MULTILIB_CFLAGS) $(INCLUDES) \
	-c -o $(T)crtn.o -x assembler-with-cpp $(srcdir)/config/tms9900/crtn.asm


